<%
  if is_update
    kyc_checkbox_points_html = @presenter_obj.page_data['verify_modal']['update_kyc_checkbox_points_html']
  else
    kyc_checkbox_points_html = @presenter_obj.page_data['verify_modal']['add_kyc_checkbox_points_html']
  end

  show_verify_modal = kyc_checkbox_points_html.present?

  tabindex_val = 1
%>

<% if @presenter_obj.is_st_token_sale_client? %>
  <%= render :partial => "/shared/web/common/loggedin_header", locals: {user: user} %>
<% else %>
  <%= render :partial => "/shared/web/common/loggedin_kycaas_header", locals: {user: user} %>
<% end %>

<div class="container" style="padding-bottom: 80px">
  <div class="row">
    <div class="col-12">
      <%= render :partial => "/shared/web/common/kycaas_logo_header" %>

      <div class="simple-token-form">
        <form class="simpletoken-form kyc-form" action="/api/user/kyc-submit" method="POST" id="kycForm">
          <div class="col-12 col-sm-12 col-lg-8 mx-auto">
            <% if is_update %>
              <h4 class="text-center mt-4 mb-2" >Update Your Registration Details</h4>
            <% else %>
              <h4 class="text-center mt-4 mb-2" >One Step Away to Access the Token
                Sale</h4>
            <% end %>
            <h6 class="kyc-instructions-title text-center mt-2">You will need the following items to complete the registration</h6>
            <% if @presenter_obj.is_st_token_sale_client? %>
              <ul class="kyc-instructions text-center">
                <li class="text-center">
                <span class="instructions-icon">
                  <span class="kyc-instructions-passport-icon icon-pos"></span>
                </span>
                  <div class="title-name display-3 my-2">Your<br/>ID Document</div>
                  <a href="https://docs.google.com/document/d/1WVPQyUZgul81MoF2DkmsAeA6vPpKJ8vtjS53GWeSov4/edit?pli=1#heading=h.1fb4f8e93alc" class="learn-more ext-links" title="Learn More" target="_blank">Learn
                    More</a>
                </li>
                <li class="text-center hidden-xs">
                <span class="instructions-icon">
                  <span class="kyc-instructions-camera-icon icon-pos"></span>
                </span>
                  <div class="title-name display-3 my-2">Camera or<br/>smartphone</div>
                  <a href="https://docs.google.com/document/d/1WVPQyUZgul81MoF2DkmsAeA6vPpKJ8vtjS53GWeSov4/edit?pli=1#heading=h.1fb4f8e93alc" class="learn-more ext-links" title="Learn More" target="_blank">Learn
                    More</a>
                </li>
                <li class=" text-center">
                <span class="instructions-icon">
                  <span class="kyc-instructions-public-ethereum-icon icon-pos"></span>
                </span>
                  <div class="title-name display-3 my-2">Your Public<br/>Ethereum address</div>
                  <a href="https://docs.google.com/document/d/1WVPQyUZgul81MoF2DkmsAeA6vPpKJ8vtjS53GWeSov4/edit?pli=1#bookmark=id.kcpwvfqta37k" class="learn-more ext-links" title="Learn More" target="_blank">Learn
                    More</a>
                </li>
              </ul>
            <% end %>

            <div class="row">
              <div class="col-12 col-sm-6">
                <div class="form-group">
                  <label class="form-label" for="first_name">First name</label>
                  <input type="text" title="First name" class="form-control" name="first_name" value="" tabindex="<%= tabindex_val %>" autofocus="" autocomplete="off" required/>
                  <% tabindex_val += 1 %>
                  <div class="error" data-for="first_name"></div>
                </div>
              </div>
              <div class="col-12 col-sm-6">
                <div class="form-group">
                  <label class="form-label" for="last_name">Last name</label>
                  <input type="text" title="Last name" class="form-control" name="last_name" value="" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                  <% tabindex_val += 1 %>
                  <div class="error" data-for="last_name"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 col-sm-6">
                <div class="form-group">
                  <label class="form-label" for="birthdate">Date of Birth</label>
                  <input type="text" title="Birth date" class="form-control" name="birthdate" placeholder="dd/mm/yyyy" pattern="(0[1-9]|1[0-9]|2[0-9]|3[01])[- /.](0[1-9]|1[012])[- /.][0-9]{4}" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                  <% tabindex_val += 1 %>
                  <div class="error" data-for="birthdate"></div>
                </div>
              </div>
            </div>


            <div class="row">
              <% if @presenter_obj.page_data['kyc_fields'].include?('stree_address') %>
                <div class="col-12 col-sm-6">
                  <div class="form-group">
                    <label class="form-label" for="street_address">Street address</label>
                    <input type="text" title="Street address" class="form-control" name="street_address" value="" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                    <% tabindex_val += 1 %>
                    <div class="error" data-for="street_address"></div>
                  </div>
                </div>
              <% end %>
              <% if @presenter_obj.page_data['kyc_fields'].include?('city') %>
                <div class="col-12 col-sm-6">
                  <div class="form-group">
                    <label class="form-label" for="">City</label>
                    <input type="text" title="City" class="form-control" name="city" value="" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                    <% tabindex_val += 1 %>
                    <div class="error" data-for="city"></div>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="row">
              <% if @presenter_obj.page_data['kyc_fields'].include?('state') %>
                <div class="col-12 col-sm-6">
                  <div class="form-group">
                    <label class="form-label" for="state">State / region</label>
                    <input type="text" title="State / region" class="form-control" name="state" value="" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                    <% tabindex_val += 1 %>
                    <div class="error" data-for="state"></div>
                  </div>
                </div>
              <% end %>
              <div class="col-12 col-sm-6">
                <div class="form-group st-selectpicker">
                  <label class="form-label" for="country">Country</label>
                  <select class="form-control selectpicker" name="country" title="Select Country" tabindex="<%= tabindex_val %>" required>
                    <% tabindex_val += 1 %>
                    <% GlobalConstant::CountryNationality.countries.each do |country_name| %>
                      <option value="<%= country_name %>" <%= @ip_to_cynopsis_country.to_s.upcase == country_name ? 'selected' : '' %>><%= country_name.titleize %></option>
                    <% end %>
                  </select>

                  <div class="error" data-for="country"></div>
                </div>
              </div>
            </div>

            <% if @presenter_obj.page_data['kyc_fields'].include?('postal_code') %>
              <div class="row">
                <div class="col-12 col-sm-6">
                  <div class="form-group">
                    <label class="form-label" for="postal_code">Zip / postal code</label>
                    <input type="text" title="Zip / postal code" class="form-control" name="postal_code" value="" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                    <% tabindex_val += 1 %>
                    <div class="error" data-for="postal_code"></div>
                  </div>
                </div>
              </div>
            <% end %>

            <div class="row form-group">
              <div class="col-12 col-sm-6">
                <div>
                  <label class="form-label" for="ethereum_address">Ethereum address</label>
                  <input type="text" title="Ethereum address" class="form-control" name="ethereum_address" pattern="(0x|0X)?[0-9a-fA-F]{40}" value="" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                  <% tabindex_val += 1 %>
                  <div class="error" data-for="ethereum_address"></div>
                </div>
              </div>
              <div class="col-12 col-sm-6">
                <div class="form-instructions display-4">
                  <%= raw @presenter_obj.page_data['ethereum_address_info_html'] %>
                </div>
              </div>
            </div>

            <% if @presenter_obj.page_data['kyc_fields'].include?('estimated_participation_amount') %>
              <div class="row">
                <div class="col-12 col-sm-6">
                  <div class="form-group">
                    <label class="form-label" for="postal_code">Estimated Participation Amount</label>
                    <input type="number" min="1" lang="en-150" title="Estimated amount ($)" class="form-control" name="estimated_participation_amount" value="0" tabindex="<%= tabindex_val %>" autocomplete="off"/>
                    <% tabindex_val += 1 %>
                    <div class="error" data-for="estimated_participation_amount"></div>
                  </div>
                </div>
              </div>
            <% end %>

            <div class="row form-group ">
              <div class="col-12 col-sm-6">
                <div >
                  <label class="form-label" for="document_id_number">Identification Document Number</label>
                  <input type="text" title="Identification Document Number" class="form-control" name="document_id_number" value="" tabindex="<%= tabindex_val %>" autocomplete="off" required/>
                  <% tabindex_val += 1 %>
                  <div class="error" data-for="document_id_number"></div>
                </div>
              </div>
              <div class="col-12 col-sm-6">
                <div class="form-instructions display-4">
                  <%= raw @presenter_obj.page_data['document_info_html'] %>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 col-sm-6">
                <div class="form-group st-selectpicker">
                  <label class="form-label" for="nationality">Nationality</label>
                  <select class="form-control selectpicker" name="nationality" title="Select Nationality" tabindex="<%= tabindex_val %>" required>
                    <% tabindex_val += 1 %>
                    <% to_show_usa_nationality = true
                       GlobalConstant::CountryNationality.nationalities.each do |nationality_name|
                         if to_show_usa_nationality && ("UNITED STATE OF AMERICA" < nationality_name)                      %>

                      <option value="AMERICAN">United States Of America</option>
                    <% to_show_usa_nationality = false
                       end
                    %>

                    <option value="<%= nationality_name %>"><%= nationality_name.titleize %></option>
                    <% end %>
                  </select>

                  <div class="error" data-for="nationality"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 col-sm-12">

                <div class="row form-group">
                  <div class="col-12">
                    <label class="form-label" for="document_id_file_path">Upload an image of your ID Document
                      <span class="badge badge-pill badge-secondary align-middle p-0">
                        <svg class="info-icon">
                          <switch>
                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#info-icon"></use>
                          </switch>
                        </svg>
                      </span>
                    </label>
                    <div class="file-name display-4 my-1"></div>
                  </div>
                  <div class="col-12 mt-2">
                    <label class="upload-file btn btn-secondary upload-image-btn">
                      <input type="file" title="Identification Document" name="document_id_file_path" class="upload btn btn-orange" accept="image/*,application/pdf" data-min-bytes="204800" data-max-bytes="15728640" tabindex="<%= tabindex_val %>" required/>
                      <% tabindex_val += 1 %>
                      <span>choose file</span>
                    </label>
                    <span class="form-instructions display-4 choose-file-instructions thumbnail-upload-instructions">Please upload a high quality <br/>scan or picture of your ID Document.<br/>(Min 200kb, JPG/PNG/PDF only)</span>
                    <div class="error" data-for="document_id_file_path"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 col-sm-12">
                <div class="row form-group">
                  <div class="col-12">
                    <label class="form-label" for="selfie_file_path">Upload a picture of you holding your ID Document
                      <span class="badge badge-pill badge-secondary align-middle p-0">
                        <svg class="info-icon">
                          <switch>
                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#info-icon"></use>
                          </switch>
                        </svg>
                      </span>
                    </label>
                    <div class="file-name display-4 my-1"></div>
                  </div>
                  <div class="col-12 mt-2">
                    <label class="upload-file btn btn-secondary upload-image-btn">
                      <input type="file" title="Selfie with your identification document" name="selfie_file_path" class="upload btn btn-orange" accept="image/*,application/pdf" data-min-bytes="204800" data-max-bytes="15728640" tabindex="<%= tabindex_val %>" required>
                      <% tabindex_val += 1 %>
                      <span>choose file</span>
                    </label>
                    <span class="form-instructions display-4 choose-file-instructions thumbnail-upload-instructions">Please upload a high quality picture<br/> of you holding your ID Document <br/>next to your face. <br/>(Min 200kb, JPG/PNG/PDF only)</span>
                    <div class="error" data-for="selfie_file_path"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row residence-proof display-none" >
              <div class="col-12 col-sm-12">
                <div class="row form-group ">
                  <div class="col-12">
                    <label class="form-label" for="residence_proof_file_path">Proof of Residence
                    </label>
                    <div class="file-name display-4 my-1"></div>
                  </div>
                  <div class="col-12 mt-2">
                    <label class="upload-file btn btn-secondary upload-image-btn">
                      <input type="file" title="Residence proof" name="residence_proof_file_path" class="upload btn btn-orange" accept="image/*,application/pdf" data-min-bytes="204800" data-max-bytes="15728640" tabindex="<%= tabindex_val %>" required/>
                      <span>choose file</span>
                      <% tabindex_val += 1 %>
                    </label>
                    <span class="form-instructions display-4 thumbnail-upload-instructions choose-file-instructions">Please upload a high quality <br/>scan of your proof of residence.<br/> (Min 200kb, JPG/PNG/PDF only)</span>
                  </div>
                  <div class="error" data-for="residence_proof_file_path"></div>
                </div>
              </div>
            </div>

            <div class="row mt-2 form-group">
              <div class="col-12 col-sm-6">
                <div class="g-recaptcha" data-sitekey="<%= GlobalConstant::Base.recaptcha['site_key'] %>" tabindex="<%= tabindex_val %>" data-callback="simpletoken_kyc_recaptcha_callback"></div>
                <% tabindex_val += 1 %>
                <div class="error" data-for="recaptcha"></div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 col-sm-12">
                <div class="form-group">
                  <div>
                    <button id="kycSubmit" class="btn btn-primary upload-image-btn" title="submit" type="submit" tabindex="<%= tabindex_val %>">Submit</button>
                    <% tabindex_val += 1 %>
                    <% if is_update %>
                      <a href="/dashboard" class="btn btn-secondary upload-image-btn ml-3" title="back" tabindex="<%= tabindex_val %>">Back</a>
                      <% tabindex_val += 1 %>
                    <% end %>
                  </div>
                  <div class="error" data-for="general_error"></div>
                </div>
              </div>
            </div>

          </div>
          <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>
          <%= hidden_field_tag GlobalConstant::Base.page_loaded_at_key, GlobalConstant::Base.current_time -%>
        </form>
        <div id="fileupload"></div>
        <input type="hidden" id="refresh-indicator" value="no">
      </div>
    </div>
  </div>
</div>

<% content_for :end_js do %>
  <script>
    $(document).ready(function () {
      simpletoken.home.kyc.init(
        {
          show_verify_modal: <%= show_verify_modal %>,
          residency_proof_nationalities: <%= raw @presenter_obj.page_data['residency_proof_nationalities'] %>
        }
      );
    });

    function simpletoken_kyc_recaptcha_callback() {
      simpletoken.home.kyc.$kycForm.find('.error[data-for="recaptcha"]').text('');
    }
  </script>
<% end %>

<%= render :partial => "/shared/web/modals/verify_modal", locals: {kyc_checkbox_points_html: kyc_checkbox_points_html} %>

<script type="custom" id="selfie-popover">
  <div style="">
      <div class="row">
        <div class="col-5">
          <img src="https://d36lai1ppm9dxu.cloudfront.net/assets/image/kyc-passport-selfie-right-image@2x-v2.png" style="max-width:100%" />
        </div>
        <div class="col-7">
          <p style="font-size:10px; color:#9aaaaa">Please hold the ID Document in your hand next to your face. Both your face and the ID Document must be clearly visible and any text, numbers or photos on the ID Document must be readable and not be covered by your fingers.</p>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <img src="https://d36lai1ppm9dxu.cloudfront.net/assets/image/kyc-passport-selfie-wrong-image@2x-v2.png" style="max-width:100%" />
        </div>
      </div>
  </div>



</script>

<script type="custom" id="passport-popover">
  <div style="">
      <div class="row">
        <div class="col-5">
          <img src="https://d36lai1ppm9dxu.cloudfront.net/assets/image/kyc-passport-right-image@2x.png" style="max-width:100%" />
        </div>
        <div class="col-7">
          <p style="font-size:10px; color:#9aaaaa">Please upload a scan or picture of your ID Document so that the entire page is visible, the image is not blurry and the camera flash is not affecting the readability. All text, numbers and photos on the ID Document must be readable.</p>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <img src="https://d36lai1ppm9dxu.cloudfront.net/assets/image/kyc-passport-wrong-image@2x.png" style="max-width:100%" />
        </div>
      </div>
  </div>



</script>

<%= render :partial => "/shared/web/common/index_svg_sprite" %>